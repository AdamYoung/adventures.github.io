import{r as l,K as J,n as re,f as ve,g as de,o as n,c as s,z as _,a,d as A,b as ce,w as fe,G as pe,D as z,F as ke,p as me,t as ye,N as he,B as R,L as G}from"./VKMNm2j-.js";import{_ as ge}from"./DlAUqK2U.js";const we={class:"slideshow"},be=["src"],Te={key:"current",class:"slide current"},xe=["src"],Me=["src"],Ce={class:"controls"},_e={key:0,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},Se={key:1,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},Ve={viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},Le={key:0,d:"M12 6L8 10H4v4h4l4 4V6z M16 8.5a5 5 0 0 1 0 7 M19 6a8 8 0 0 1 0 12","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},Be={key:1,d:"M12 6L8 10H4v4h4l4 4V6z M18 12l3-3 M18 12l3 3","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},Ae={viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},ze={key:0},je={key:1},De={__name:"Story_new",props:{slides:{type:Array,required:!0,validator:y=>y.every(f=>typeof f.text=="string"&&(typeof f.image=="string"||typeof f.video=="string"))},musicSrc:{type:String,default:""}},setup(y){const f=y,i=l(null),j=l(!1),v=l(0),D=l([]),E=l(-1),h=l(!1),b=l(!1),r=J(()=>f.slides[v.value]);J(()=>v.value<f.slides.length-1?f.slides[v.value+1]:null);const u=l(null),d=l(!1),p=l(!0),S=l(!0),k=l(!1),t=l(null),I=l(!1),m=l(!1),T=l(!1),x=l(null),M=l(null),N=l(null),P=l(null),F=l(!1),H=l(0),U=l(0),g=l(!0),$=l(!1),K=l(!0),c=l(!1),C=l(!1);function O(){C.value=!C.value,i.value&&(C.value?i.value.pause():g.value||i.value.play().catch(o=>console.warn("Background music playback failed:",o)))}re(async()=>{if("speechSynthesis"in window)try{const o=new Audio;o.muted=!0,await o.play(),$.value=!0,g.value=!1,W()}catch{$.value=!1,g.value=!0}else console.error("Speech synthesis not supported")});function W(){g.value=!1,i.value&&j.value&&!C.value&&(i.value.volume=.2,i.value.play().catch(o=>console.warn("Background music playback failed:",o))),K.value?(K.value=!1,requestAnimationFrame(()=>{clearTimeout(P.value),P.value=setTimeout(()=>{w()},100)})):w()}function Q(){h.value=!1,d.value=!1,u.value?(u.value.currentTime=0,setTimeout(()=>{d.value=!0,u.value.play(),w()},500)):w()}ve(r,()=>{},{immediate:!0}),de(()=>{clearTimeout(x.value),clearTimeout(M.value),clearTimeout(N.value),clearTimeout(P.value),stop(),i.value&&i.value.pause()});function X(){u.value&&(u.value.pause(),u.value.currentTime=0)}function Y(){t.value&&(c.value=!1,t.value.pause(),t.value.currentTime=0)}function w(){if(D.value=r.value.text.split(" "),E.value=-1,h.value=!1,d.value=!1,S.value=!0,I.value=!1,m.value=!1,T.value=!1,F.value=!1,d.value=!1,H.value=0,U.value=0,r.value.video&&u.value){u.value.load();const o=()=>{!k.value&&t.value&&!c.value?(c.value=!0,t.value.load()):(d.value=!0,u.value.play().catch(e=>console.warn("Video playback failed:",e)))};u.value.removeEventListener("loadeddata",o),u.value.addEventListener("loadeddata",o,{once:!0})}else!k.value&&t.value&&!c.value?(c.value=!0,t.value.load(),t.value.play().catch(o=>{console.warn("Audio playback failed:",o),c.value=!1})):p.value&&(clearTimeout(M.value),M.value=setTimeout(()=>V(),3e3));b.value=!1}function Z(){if(!u.value||!t.value)return 0;const o=H.value,e=U.value;return e>o?(e-o)*1e3:0}function ee(){F.value=!0,u.value&&(H.value=u.value.duration)}function le(){if(c.value&&t.value){if(I.value=!0,U.value=t.value.duration,t.value.currentTime=0,t.value.play().catch(o=>console.warn("Audio playback failed:",o)),r.value.video&&u.value&&F.value){const o=Z();clearTimeout(N.value),N.value=setTimeout(()=>{d.value=!0,u.value.currentTime=0,u.value.play().catch(e=>console.warn("Video playback failed:",e))},o)}c.value=!1}}function ae(){c.value=!1,m.value=!0,S.value=!1,q()}function oe(){T.value=!0,q()}function q(){(m.value||k.value)&&(!r.value.video||T.value)&&(h.value=!0,p.value&&(clearTimeout(M.value),M.value=setTimeout(()=>V(),1500)))}function V(){v.value<f.slides.length-1&&!b.value&&(b.value=!0,d.value=!1,m.value=!1,T.value=!1,v.value++,clearTimeout(x.value),x.value=setTimeout(()=>{w()},500))}function te(){v.value>0&&!b.value&&(b.value=!0,d.value=!1,X(),Y(),m.value=!1,T.value=!1,v.value--,clearTimeout(x.value),x.value=setTimeout(()=>{w()},500))}function ue(){p.value=!p.value,p.value&&h.value&&(u.value?(d.value=!0,u.value.play().catch(o=>console.warn("Video playback failed:",o))):V())}function ne(){k.value=!k.value,k.value?(t.value&&(t.value.pause(),m.value=!0,q()),i.value&&i.value.pause()):(t.value&&I.value&&(m.value=!1,t.value.play(),S.value=!0),i.value&&j.value&&i.value.play())}function se(){if(t.value){const o=t.value.currentTime,e=t.value.duration,L=D.value.length,B=Math.floor(o/e*L);E.value=Math.min(B,L-1)}}function ie(){j.value=!0,g.value||(i.value.volume=.2,i.value.play().catch(o=>console.warn("Background music playback failed:",o)))}return(o,e)=>(n(),s("div",we,[y.musicSrc?(n(),s("audio",{key:0,ref_key:"backgroundMusic",ref:i,src:y.musicSrc,loop:"",preload:"auto",onLoadeddata:ie},null,40,be)):_("",!0),g.value&&!$.value?(n(),s("div",{key:1,class:"interaction-overlay",onClick:W},e[0]||(e[0]=[a("button",{class:"start-button","aria-label":"Start presentation"},[a("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[a("path",{d:"M8 5v14l11-7z","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})]),a("span",null,[A("Start"),a("br"),A("Story")])],-1)]))):_("",!0),ce(he,{name:"fade",mode:"out-in"},{default:fe(()=>[r.value?(n(),s("div",Te,[a("div",{class:"slide-media",style:pe({backgroundImage:`url(${r.value.image||""})`})},null,4),r.value.video?(n(),s("video",{key:0,ref_key:"currentVideo",ref:u,class:z(["slide-media",{"video-ready":d.value}]),src:r.value.video,preload:"auto",muted:"",playsinline:"",loop:!1,onLoadeddata:ee,onEnded:oe},null,42,xe)):_("",!0),r.value.audio?(n(),s("audio",{key:1,ref_key:"currentAudio",ref:t,src:r.value.audio,preload:"auto",onLoadeddata:le,onEnded:ae,onTimeupdate:se},null,40,Me)):_("",!0),a("div",{class:z(["slide-text",{"fade-out":!S.value}])},[(n(!0),s(ke,null,me(D.value,(L,B)=>(n(),s("span",{key:`${v.value}-${B}`,class:z({highlight:B===E.value})},ye(L),3))),128))],2)])):_("",!0)]),_:1}),a("div",Ce,[R(a("button",{class:"control-button left",onClick:te,"aria-label":"Previous slide"},e[1]||(e[1]=[a("svg",{class:"chevron",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[a("path",{d:"M15.5 5.5L8.5 12l7 6.5","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)]),512),[[G,v.value>0]]),R(a("button",{class:z(["control-button right",{pulse:h.value}]),onClick:V,"aria-label":"Next slide"},e[2]||(e[2]=[a("svg",{class:"chevron",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[a("path",{d:"M8.5 5.5L15.5 12l-7 6.5","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)]),2),[[G,v.value<y.slides.length-1]])]),a("button",{class:"control-button auto-play",onClick:ue,"aria-label":"Toggle auto play"},[p.value?(n(),s("svg",Se,e[4]||(e[4]=[a("path",{d:"M6 4h4v16H6V4zM14 4h4v16h-4V4z","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)]))):(n(),s("svg",_e,e[3]||(e[3]=[a("path",{d:"M5 3l14 9-14 9V3z","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)]))),e[5]||(e[5]=a("span",null,[A("Auto"),a("br"),A("Play")],-1))]),R(a("button",{class:"control-button replay",onClick:Q,"aria-label":"Replay slide"},e[6]||(e[6]=[a("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[a("path",{d:"M3 12a9 9 0 1 1 2.83 6.54M3 12V8m0 4h4","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)]),512),[[G,h.value&&!p.value]]),a("button",{class:"control-button speech-toggle",onClick:ne,"aria-label":"Toggle speech"},[(n(),s("svg",Ve,[k.value?(n(),s("path",Be)):(n(),s("path",Le))]))]),a("button",{class:"control-button music-toggle",onClick:O,"aria-label":"Toggle background music"},[(n(),s("svg",Ae,[e[9]||(e[9]=a("path",{d:"M9 18V6l12-2v12 M9 9h4","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)),C.value?(n(),s("g",je,e[8]||(e[8]=[a("circle",{cx:"17",cy:"16",r:"3","stroke-width":"2"},null,-1),a("line",{x1:"14",y1:"13",x2:"20",y2:"19","stroke-width":"2","stroke-linecap":"round"},null,-1)]))):(n(),s("g",ze,e[7]||(e[7]=[a("circle",{cx:"17",cy:"16",r:"3","stroke-width":"2"},null,-1)])))]))])]))}},Ne=ge(De,[["__scopeId","data-v-78e20574"]]);export{Ne as _};
